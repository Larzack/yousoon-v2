# ============================================
# YOUSOON SUPERGRAPH SCHEMA
# Apollo Federation 2 Composed Schema
# Generated by rover supergraph compose
# ============================================

schema
  @link(url: "https://specs.apollo.dev/link/v1.0")
  @link(url: "https://specs.apollo.dev/join/v0.3", for: EXECUTION)
{
  query: Query
  mutation: Mutation
  subscription: Subscription
}

directive @join__enumValue(graph: join__Graph!) repeatable on ENUM_VALUE

directive @join__field(
  graph: join__Graph
  requires: join__FieldSet
  provides: join__FieldSet
  type: String
  external: Boolean
  override: String
  usedOverridden: Boolean
) repeatable on FIELD_DEFINITION | INPUT_FIELD_DEFINITION

directive @join__graph(name: String!, url: String!) on ENUM_VALUE

directive @join__implements(
  graph: join__Graph!
  interface: String!
) repeatable on OBJECT | INTERFACE

directive @join__type(
  graph: join__Graph!
  key: join__FieldSet
  extension: Boolean! = false
  resolvable: Boolean! = true
  isInterfaceObject: Boolean! = false
) repeatable on OBJECT | INTERFACE | UNION | ENUM | INPUT_OBJECT | SCALAR

directive @join__unionMember(graph: join__Graph!, member: String!) repeatable on UNION

directive @link(
  url: String
  as: String
  for: link__Purpose
  import: [link__Import]
) repeatable on SCHEMA

scalar join__FieldSet
scalar link__Import
enum link__Purpose {
  SECURITY
  EXECUTION
}

enum join__Graph {
  IDENTITY @join__graph(name: "identity", url: "http://identity-service:8080/graphql")
  PARTNER @join__graph(name: "partner", url: "http://partner-service:8080/graphql")
  DISCOVERY @join__graph(name: "discovery", url: "http://discovery-service:8080/graphql")
  BOOKING @join__graph(name: "booking", url: "http://booking-service:8080/graphql")
  ENGAGEMENT @join__graph(name: "engagement", url: "http://engagement-service:8080/graphql")
  NOTIFICATION @join__graph(name: "notification", url: "http://notification-service:8080/graphql")
}

# ============================================
# SHARED TYPES
# ============================================

type Query
  @join__type(graph: IDENTITY)
  @join__type(graph: PARTNER)
  @join__type(graph: DISCOVERY)
  @join__type(graph: BOOKING)
  @join__type(graph: ENGAGEMENT)
  @join__type(graph: NOTIFICATION)
{
  # Identity
  me: User @join__field(graph: IDENTITY)
  user(id: ID!): User @join__field(graph: IDENTITY)
  
  # Partner
  partner(id: ID!): Partner @join__field(graph: PARTNER)
  establishment(id: ID!): Establishment @join__field(graph: PARTNER)
  myPartner: Partner @join__field(graph: PARTNER)
  
  # Discovery
  offers(input: OffersInput!): OffersConnection! @join__field(graph: DISCOVERY)
  offer(id: ID!): Offer @join__field(graph: DISCOVERY)
  searchOffers(input: SearchOffersInput!): OffersConnection! @join__field(graph: DISCOVERY)
  nearbyOffers(input: NearbyOffersInput!): OffersConnection! @join__field(graph: DISCOVERY)
  categories: [Category!]! @join__field(graph: DISCOVERY)
  category(id: ID!): Category @join__field(graph: DISCOVERY)
  
  # Booking
  outing(id: ID!): Outing @join__field(graph: BOOKING)
  myOutings(input: MyOutingsInput!): OutingsConnection! @join__field(graph: BOOKING)
  outingByQRCode(code: String!): Outing @join__field(graph: BOOKING)
  
  # Engagement
  myFavorites(first: Int, after: String): FavoritesConnection! @join__field(graph: ENGAGEMENT)
  offerReviews(offerId: ID!, first: Int, after: String): ReviewsConnection! @join__field(graph: ENGAGEMENT)
  myReviews(first: Int, after: String): ReviewsConnection! @join__field(graph: ENGAGEMENT)
  
  # Notification
  myNotifications(first: Int, after: String, unreadOnly: Boolean): NotificationsConnection! @join__field(graph: NOTIFICATION)
  notificationSettings: NotificationSettings! @join__field(graph: NOTIFICATION)
}

type Mutation
  @join__type(graph: IDENTITY)
  @join__type(graph: PARTNER)
  @join__type(graph: DISCOVERY)
  @join__type(graph: BOOKING)
  @join__type(graph: ENGAGEMENT)
  @join__type(graph: NOTIFICATION)
{
  # Identity
  register(input: RegisterInput!): AuthPayload! @join__field(graph: IDENTITY)
  login(input: LoginInput!): AuthPayload! @join__field(graph: IDENTITY)
  refreshToken(refreshToken: String!): AuthPayload! @join__field(graph: IDENTITY)
  logout: Boolean! @join__field(graph: IDENTITY)
  updateProfile(input: UpdateProfileInput!): User! @join__field(graph: IDENTITY)
  submitIdentityVerification(input: IdentityVerificationInput!): IdentityVerification! @join__field(graph: IDENTITY)
  updatePreferences(input: UpdatePreferencesInput!): User! @join__field(graph: IDENTITY)
  deleteAccount: Boolean! @join__field(graph: IDENTITY)
  
  # Partner
  registerPartner(input: RegisterPartnerInput!): Partner! @join__field(graph: PARTNER)
  updatePartner(input: UpdatePartnerInput!): Partner! @join__field(graph: PARTNER)
  createEstablishment(input: CreateEstablishmentInput!): Establishment! @join__field(graph: PARTNER)
  updateEstablishment(id: ID!, input: UpdateEstablishmentInput!): Establishment! @join__field(graph: PARTNER)
  deleteEstablishment(id: ID!): Boolean! @join__field(graph: PARTNER)
  inviteTeamMember(input: InviteTeamMemberInput!): TeamMember! @join__field(graph: PARTNER)
  removeTeamMember(id: ID!): Boolean! @join__field(graph: PARTNER)
  
  # Discovery
  createOffer(input: CreateOfferInput!): Offer! @join__field(graph: DISCOVERY)
  updateOffer(id: ID!, input: UpdateOfferInput!): Offer! @join__field(graph: DISCOVERY)
  publishOffer(id: ID!): Offer! @join__field(graph: DISCOVERY)
  unpublishOffer(id: ID!): Offer! @join__field(graph: DISCOVERY)
  deleteOffer(id: ID!): Boolean! @join__field(graph: DISCOVERY)
  
  # Booking
  createOuting(input: CreateOutingInput!): Outing! @join__field(graph: BOOKING)
  checkInOuting(id: ID!, qrCode: String!): Outing! @join__field(graph: BOOKING)
  cancelOuting(id: ID!, reason: String): Outing! @join__field(graph: BOOKING)
  
  # Engagement
  addFavorite(offerId: ID!): Favorite! @join__field(graph: ENGAGEMENT)
  removeFavorite(offerId: ID!): Boolean! @join__field(graph: ENGAGEMENT)
  createReview(input: CreateReviewInput!): Review! @join__field(graph: ENGAGEMENT)
  updateReview(id: ID!, input: UpdateReviewInput!): Review! @join__field(graph: ENGAGEMENT)
  deleteReview(id: ID!): Boolean! @join__field(graph: ENGAGEMENT)
  reportReview(id: ID!, reason: String!): Boolean! @join__field(graph: ENGAGEMENT)
  
  # Notification
  registerDevice(input: RegisterDeviceInput!): DeviceToken! @join__field(graph: NOTIFICATION)
  unregisterDevice(token: String!): Boolean! @join__field(graph: NOTIFICATION)
  updateNotificationSettings(input: UpdateNotificationSettingsInput!): NotificationSettings! @join__field(graph: NOTIFICATION)
  markNotificationRead(id: ID!): Notification! @join__field(graph: NOTIFICATION)
  markAllNotificationsRead: Boolean! @join__field(graph: NOTIFICATION)
}

type Subscription
  @join__type(graph: DISCOVERY)
  @join__type(graph: BOOKING)
  @join__type(graph: NOTIFICATION)
{
  # Discovery
  newOfferNearby(location: LocationInput!): Offer! @join__field(graph: DISCOVERY)
  
  # Booking
  outingStatusChanged(outingId: ID!): Outing! @join__field(graph: BOOKING)
  
  # Notification
  notificationReceived: Notification! @join__field(graph: NOTIFICATION)
}

# ============================================
# IDENTITY TYPES
# ============================================

type User
  @join__type(graph: IDENTITY, key: "id")
  @join__type(graph: BOOKING, key: "id")
  @join__type(graph: ENGAGEMENT, key: "id")
{
  id: ID!
  email: String! @join__field(graph: IDENTITY)
  phone: String @join__field(graph: IDENTITY)
  profile: Profile! @join__field(graph: IDENTITY)
  identity: IdentityVerification @join__field(graph: IDENTITY)
  subscription: Subscription @join__field(graph: IDENTITY)
  preferences: Preferences! @join__field(graph: IDENTITY)
  grade: UserGrade! @join__field(graph: IDENTITY)
  status: UserStatus! @join__field(graph: IDENTITY)
  createdAt: DateTime! @join__field(graph: IDENTITY)
  
  # From Booking
  outings(first: Int, after: String): OutingsConnection! @join__field(graph: BOOKING)
  
  # From Engagement
  favorites(first: Int, after: String): FavoritesConnection! @join__field(graph: ENGAGEMENT)
  reviews(first: Int, after: String): ReviewsConnection! @join__field(graph: ENGAGEMENT)
}

type Profile @join__type(graph: IDENTITY) {
  firstName: String!
  lastName: String!
  displayName: String!
  avatar: String
  birthDate: Date
  gender: Gender
}

type IdentityVerification @join__type(graph: IDENTITY) {
  id: ID!
  status: VerificationStatus!
  documentType: DocumentType
  submittedAt: DateTime!
  verifiedAt: DateTime
  rejectedAt: DateTime
  rejectionReason: String
}

type UserSubscription @join__type(graph: IDENTITY) {
  id: ID!
  plan: SubscriptionPlan!
  status: SubscriptionStatus!
  platform: Platform!
  startDate: DateTime!
  endDate: DateTime!
  autoRenew: Boolean!
  cancelledAt: DateTime
}

type Preferences @join__type(graph: IDENTITY) {
  language: String!
  notifications: NotificationPreferences!
  categories: [ID!]!
  maxDistance: Int!
}

type NotificationPreferences @join__type(graph: IDENTITY) {
  push: Boolean!
  email: Boolean!
  sms: Boolean!
  marketing: Boolean!
}

type AuthPayload @join__type(graph: IDENTITY) {
  accessToken: String!
  refreshToken: String!
  expiresAt: DateTime!
  user: User!
}

enum UserStatus @join__type(graph: IDENTITY) {
  ACTIVE @join__enumValue(graph: IDENTITY)
  SUSPENDED @join__enumValue(graph: IDENTITY)
  DELETED @join__enumValue(graph: IDENTITY)
  PENDING_DELETION @join__enumValue(graph: IDENTITY)
}

enum UserGrade @join__type(graph: IDENTITY) {
  EXPLORATEUR @join__enumValue(graph: IDENTITY)
  AVENTURIER @join__enumValue(graph: IDENTITY)
  GRAND_VOYAGEUR @join__enumValue(graph: IDENTITY)
  CONQUERANT @join__enumValue(graph: IDENTITY)
}

enum VerificationStatus @join__type(graph: IDENTITY) {
  NOT_SUBMITTED @join__enumValue(graph: IDENTITY)
  PENDING @join__enumValue(graph: IDENTITY)
  VERIFIED @join__enumValue(graph: IDENTITY)
  REJECTED @join__enumValue(graph: IDENTITY)
}

enum DocumentType @join__type(graph: IDENTITY) {
  CNI @join__enumValue(graph: IDENTITY)
  PASSPORT @join__enumValue(graph: IDENTITY)
  DRIVING_LICENSE @join__enumValue(graph: IDENTITY)
}

enum SubscriptionPlan @join__type(graph: IDENTITY) {
  FREE @join__enumValue(graph: IDENTITY)
  MONTHLY @join__enumValue(graph: IDENTITY)
  YEARLY @join__enumValue(graph: IDENTITY)
}

enum SubscriptionStatus @join__type(graph: IDENTITY) {
  TRIALING @join__enumValue(graph: IDENTITY)
  ACTIVE @join__enumValue(graph: IDENTITY)
  PAST_DUE @join__enumValue(graph: IDENTITY)
  CANCELLED @join__enumValue(graph: IDENTITY)
  EXPIRED @join__enumValue(graph: IDENTITY)
}

enum Platform @join__type(graph: IDENTITY) {
  IOS @join__enumValue(graph: IDENTITY)
  ANDROID @join__enumValue(graph: IDENTITY)
  WEB @join__enumValue(graph: IDENTITY)
}

enum Gender @join__type(graph: IDENTITY) {
  MALE @join__enumValue(graph: IDENTITY)
  FEMALE @join__enumValue(graph: IDENTITY)
  OTHER @join__enumValue(graph: IDENTITY)
}

# ============================================
# PARTNER TYPES
# ============================================

type Partner
  @join__type(graph: PARTNER, key: "id")
  @join__type(graph: DISCOVERY, key: "id")
{
  id: ID!
  company: Company! @join__field(graph: PARTNER)
  branding: Branding! @join__field(graph: PARTNER)
  contact: Contact! @join__field(graph: PARTNER)
  category: String! @join__field(graph: PARTNER)
  subcategories: [String!]! @join__field(graph: PARTNER)
  establishments: [Establishment!]! @join__field(graph: PARTNER)
  team: [TeamMember!]! @join__field(graph: PARTNER)
  stats: PartnerStats! @join__field(graph: PARTNER)
  status: PartnerStatus! @join__field(graph: PARTNER)
  verifiedAt: DateTime @join__field(graph: PARTNER)
  createdAt: DateTime! @join__field(graph: PARTNER)
  
  # From Discovery
  offers(first: Int, after: String): OffersConnection! @join__field(graph: DISCOVERY)
}

type Company @join__type(graph: PARTNER) {
  name: String!
  tradeName: String
  siret: String!
  vatNumber: String
  legalForm: String
}

type Branding @join__type(graph: PARTNER) {
  logo: String
  coverImage: String
  primaryColor: String
  description: String
}

type Contact @join__type(graph: PARTNER) {
  firstName: String!
  lastName: String!
  email: String!
  phone: String
  role: String
}

type Establishment
  @join__type(graph: PARTNER, key: "id")
  @join__type(graph: DISCOVERY, key: "id")
{
  id: ID!
  partnerId: ID! @join__field(graph: PARTNER)
  name: String! @join__field(graph: PARTNER)
  description: String @join__field(graph: PARTNER)
  address: Address! @join__field(graph: PARTNER)
  location: Location! @join__field(graph: PARTNER)
  contact: EstablishmentContact @join__field(graph: PARTNER)
  openingHours: [OpeningHour!]! @join__field(graph: PARTNER)
  images: [Image!]! @join__field(graph: PARTNER)
  features: [String!]! @join__field(graph: PARTNER)
  type: String @join__field(graph: PARTNER)
  priceRange: Int @join__field(graph: PARTNER)
  isActive: Boolean! @join__field(graph: PARTNER)
  
  # From Discovery
  offers(first: Int, after: String): OffersConnection! @join__field(graph: DISCOVERY)
}

type Address @join__type(graph: PARTNER) {
  street: String!
  streetNumber: String
  complement: String
  postalCode: String!
  city: String!
  country: String!
  formatted: String!
}

type Location @join__type(graph: PARTNER) @join__type(graph: DISCOVERY) {
  longitude: Float!
  latitude: Float!
}

type EstablishmentContact @join__type(graph: PARTNER) {
  phone: String
  email: String
  website: String
}

type OpeningHour @join__type(graph: PARTNER) {
  dayOfWeek: Int!
  open: String!
  close: String!
  isClosed: Boolean!
}

type Image @join__type(graph: PARTNER) @join__type(graph: DISCOVERY) {
  url: String!
  alt: String
  isPrimary: Boolean!
  order: Int!
}

type TeamMember @join__type(graph: PARTNER) {
  id: ID!
  userId: ID
  email: String!
  firstName: String
  lastName: String
  role: TeamRole!
  invitedAt: DateTime!
  joinedAt: DateTime
  status: TeamMemberStatus!
}

type PartnerStats @join__type(graph: PARTNER) {
  totalOffers: Int!
  activeOffers: Int!
  totalBookings: Int!
  totalCheckins: Int!
  avgRating: Float!
  reviewCount: Int!
}

enum PartnerStatus @join__type(graph: PARTNER) {
  PENDING @join__enumValue(graph: PARTNER)
  ACTIVE @join__enumValue(graph: PARTNER)
  SUSPENDED @join__enumValue(graph: PARTNER)
}

enum TeamRole @join__type(graph: PARTNER) {
  ADMIN @join__enumValue(graph: PARTNER)
  MANAGER @join__enumValue(graph: PARTNER)
  STAFF @join__enumValue(graph: PARTNER)
  VIEWER @join__enumValue(graph: PARTNER)
}

enum TeamMemberStatus @join__type(graph: PARTNER) {
  PENDING @join__enumValue(graph: PARTNER)
  ACTIVE @join__enumValue(graph: PARTNER)
  INACTIVE @join__enumValue(graph: PARTNER)
}

# ============================================
# DISCOVERY TYPES
# ============================================

type Offer
  @join__type(graph: DISCOVERY, key: "id")
  @join__type(graph: BOOKING, key: "id")
  @join__type(graph: ENGAGEMENT, key: "id")
{
  id: ID!
  partnerId: ID! @join__field(graph: DISCOVERY)
  establishmentId: ID! @join__field(graph: DISCOVERY)
  title: String! @join__field(graph: DISCOVERY)
  description: String! @join__field(graph: DISCOVERY)
  shortDescription: String @join__field(graph: DISCOVERY)
  category: Category! @join__field(graph: DISCOVERY)
  tags: [String!]! @join__field(graph: DISCOVERY)
  discount: Discount! @join__field(graph: DISCOVERY)
  conditions: [Condition!]! @join__field(graph: DISCOVERY)
  validity: Validity! @join__field(graph: DISCOVERY)
  schedule: Schedule @join__field(graph: DISCOVERY)
  quota: Quota @join__field(graph: DISCOVERY)
  images: [Image!]! @join__field(graph: DISCOVERY)
  partner: Partner! @join__field(graph: DISCOVERY)
  establishment: Establishment! @join__field(graph: DISCOVERY)
  stats: OfferStats! @join__field(graph: DISCOVERY)
  status: OfferStatus! @join__field(graph: DISCOVERY)
  isActive: Boolean! @join__field(graph: DISCOVERY)
  distance: Float @join__field(graph: DISCOVERY)
  createdAt: DateTime! @join__field(graph: DISCOVERY)
  publishedAt: DateTime @join__field(graph: DISCOVERY)
  
  # From Engagement
  reviews(first: Int, after: String): ReviewsConnection! @join__field(graph: ENGAGEMENT)
  averageRating: Float @join__field(graph: ENGAGEMENT)
  reviewCount: Int! @join__field(graph: ENGAGEMENT)
  isFavorited: Boolean! @join__field(graph: ENGAGEMENT)
}

type Category @join__type(graph: DISCOVERY, key: "id") {
  id: ID!
  name: LocalizedString!
  slug: String!
  description: LocalizedString
  icon: String
  color: String
  image: String
  parent: Category
  children: [Category!]!
  order: Int!
  isActive: Boolean!
}

type LocalizedString @join__type(graph: DISCOVERY) {
  fr: String!
  en: String!
}

type Discount @join__type(graph: DISCOVERY) @join__type(graph: BOOKING) {
  type: DiscountType!
  value: Int!
  originalPrice: Int
  formula: String
}

type Condition @join__type(graph: DISCOVERY) {
  type: String!
  value: String!
  label: String!
}

type Validity @join__type(graph: DISCOVERY) {
  startDate: DateTime!
  endDate: DateTime!
  timezone: String!
}

type Schedule @join__type(graph: DISCOVERY) {
  allDay: Boolean!
  slots: [TimeSlot!]!
}

type TimeSlot @join__type(graph: DISCOVERY) {
  dayOfWeek: Int!
  startTime: String!
  endTime: String!
}

type Quota @join__type(graph: DISCOVERY) {
  total: Int
  perUser: Int
  perDay: Int
  used: Int!
}

type OfferStats @join__type(graph: DISCOVERY) {
  views: Int!
  bookings: Int!
  checkins: Int!
  favorites: Int!
}

type OffersConnection @join__type(graph: DISCOVERY) @join__type(graph: ENGAGEMENT) {
  edges: [OfferEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type OfferEdge @join__type(graph: DISCOVERY) @join__type(graph: ENGAGEMENT) {
  node: Offer!
  cursor: String!
}

enum OfferStatus @join__type(graph: DISCOVERY) {
  DRAFT @join__enumValue(graph: DISCOVERY)
  PENDING @join__enumValue(graph: DISCOVERY)
  ACTIVE @join__enumValue(graph: DISCOVERY)
  PAUSED @join__enumValue(graph: DISCOVERY)
  EXPIRED @join__enumValue(graph: DISCOVERY)
  ARCHIVED @join__enumValue(graph: DISCOVERY)
}

enum DiscountType @join__type(graph: DISCOVERY) @join__type(graph: BOOKING) {
  PERCENTAGE @join__enumValue(graph: DISCOVERY) @join__enumValue(graph: BOOKING)
  FIXED @join__enumValue(graph: DISCOVERY) @join__enumValue(graph: BOOKING)
  FORMULA @join__enumValue(graph: DISCOVERY) @join__enumValue(graph: BOOKING)
}

# ============================================
# BOOKING TYPES
# ============================================

type Outing
  @join__type(graph: BOOKING, key: "id")
{
  id: ID!
  userId: ID!
  offerId: ID!
  offer: Offer!
  user: User!
  qrCode: QRCode!
  status: OutingStatus!
  bookedAt: DateTime!
  expiresAt: DateTime!
  checkedInAt: DateTime
  cancelledAt: DateTime
  cancellationReason: String
  offerSnapshot: OfferSnapshot!
  createdAt: DateTime!
}

type QRCode @join__type(graph: BOOKING) {
  code: String!
  data: String!
  expiresAt: DateTime!
}

type OfferSnapshot @join__type(graph: BOOKING) {
  title: String!
  description: String!
  discount: Discount!
  partnerName: String!
  establishmentName: String!
  establishmentAddress: String!
  images: [String!]!
}

type OutingsConnection @join__type(graph: BOOKING) {
  edges: [OutingEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type OutingEdge @join__type(graph: BOOKING) {
  node: Outing!
  cursor: String!
}

enum OutingStatus @join__type(graph: BOOKING) {
  PENDING @join__enumValue(graph: BOOKING)
  CONFIRMED @join__enumValue(graph: BOOKING)
  CHECKED_IN @join__enumValue(graph: BOOKING)
  CANCELLED @join__enumValue(graph: BOOKING)
  EXPIRED @join__enumValue(graph: BOOKING)
  NO_SHOW @join__enumValue(graph: BOOKING)
}

# ============================================
# ENGAGEMENT TYPES
# ============================================

type Favorite @join__type(graph: ENGAGEMENT, key: "id") {
  id: ID!
  userId: ID!
  offerId: ID!
  offer: Offer!
  createdAt: DateTime!
}

type FavoritesConnection @join__type(graph: ENGAGEMENT) {
  edges: [FavoriteEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type FavoriteEdge @join__type(graph: ENGAGEMENT) {
  node: Favorite!
  cursor: String!
}

type Review @join__type(graph: ENGAGEMENT, key: "id") {
  id: ID!
  userId: ID!
  offerId: ID!
  user: User!
  offer: Offer!
  rating: Int!
  title: String
  content: String!
  images: [String!]!
  helpfulCount: Int!
  isVerifiedPurchase: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type ReviewsConnection @join__type(graph: ENGAGEMENT) {
  edges: [ReviewEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
  averageRating: Float
}

type ReviewEdge @join__type(graph: ENGAGEMENT) {
  node: Review!
  cursor: String!
}

# ============================================
# NOTIFICATION TYPES
# ============================================

type Notification @join__type(graph: NOTIFICATION, key: "id") {
  id: ID!
  userId: ID!
  type: NotificationType!
  channel: NotificationChannel!
  title: String!
  body: String!
  image: String
  data: String
  relatedType: String
  relatedId: ID
  status: NotificationStatus!
  sentAt: DateTime
  readAt: DateTime
  createdAt: DateTime!
}

type NotificationsConnection @join__type(graph: NOTIFICATION) {
  edges: [NotificationEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
  unreadCount: Int!
}

type NotificationEdge @join__type(graph: NOTIFICATION) {
  node: Notification!
  cursor: String!
}

type DeviceToken @join__type(graph: NOTIFICATION) {
  id: ID!
  token: String!
  platform: Platform!
  createdAt: DateTime!
}

type NotificationSettings @join__type(graph: NOTIFICATION) {
  push: Boolean!
  email: Boolean!
  sms: Boolean!
  marketing: Boolean!
  offerNearby: Boolean!
  bookingReminder: Boolean!
}

enum NotificationType @join__type(graph: NOTIFICATION) {
  OFFER_NEARBY @join__enumValue(graph: NOTIFICATION)
  BOOKING_CONFIRMED @join__enumValue(graph: NOTIFICATION)
  BOOKING_REMINDER @join__enumValue(graph: NOTIFICATION)
  BOOKING_CANCELLED @join__enumValue(graph: NOTIFICATION)
  CHECK_IN_SUCCESS @join__enumValue(graph: NOTIFICATION)
  NEW_OFFER @join__enumValue(graph: NOTIFICATION)
  MARKETING @join__enumValue(graph: NOTIFICATION)
  SYSTEM @join__enumValue(graph: NOTIFICATION)
}

enum NotificationChannel @join__type(graph: NOTIFICATION) {
  PUSH @join__enumValue(graph: NOTIFICATION)
  EMAIL @join__enumValue(graph: NOTIFICATION)
  SMS @join__enumValue(graph: NOTIFICATION)
}

enum NotificationStatus @join__type(graph: NOTIFICATION) {
  PENDING @join__enumValue(graph: NOTIFICATION)
  SENT @join__enumValue(graph: NOTIFICATION)
  DELIVERED @join__enumValue(graph: NOTIFICATION)
  READ @join__enumValue(graph: NOTIFICATION)
  FAILED @join__enumValue(graph: NOTIFICATION)
}

# ============================================
# SHARED TYPES
# ============================================

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

scalar DateTime
scalar Date

# ============================================
# INPUT TYPES - IDENTITY
# ============================================

input RegisterInput @join__type(graph: IDENTITY) {
  email: String!
  password: String!
  firstName: String!
  lastName: String!
  phone: String
  platform: Platform!
}

input LoginInput @join__type(graph: IDENTITY) {
  email: String!
  password: String!
}

input UpdateProfileInput @join__type(graph: IDENTITY) {
  firstName: String
  lastName: String
  avatar: String
  birthDate: Date
  gender: Gender
  phone: String
}

input IdentityVerificationInput @join__type(graph: IDENTITY) {
  documentType: DocumentType!
  frontImage: String!
  backImage: String
  selfieImage: String
}

input UpdatePreferencesInput @join__type(graph: IDENTITY) {
  language: String
  notifications: NotificationPreferencesInput
  categories: [ID!]
  maxDistance: Int
}

input NotificationPreferencesInput @join__type(graph: IDENTITY) {
  push: Boolean
  email: Boolean
  sms: Boolean
  marketing: Boolean
}

# ============================================
# INPUT TYPES - PARTNER
# ============================================

input RegisterPartnerInput @join__type(graph: PARTNER) {
  company: CompanyInput!
  contact: ContactInput!
  category: String!
}

input CompanyInput @join__type(graph: PARTNER) {
  name: String!
  tradeName: String
  siret: String!
  vatNumber: String
  legalForm: String
}

input ContactInput @join__type(graph: PARTNER) {
  firstName: String!
  lastName: String!
  email: String!
  phone: String
  role: String
}

input UpdatePartnerInput @join__type(graph: PARTNER) {
  branding: BrandingInput
  contact: ContactInput
  subcategories: [String!]
}

input BrandingInput @join__type(graph: PARTNER) {
  logo: String
  coverImage: String
  primaryColor: String
  description: String
}

input CreateEstablishmentInput @join__type(graph: PARTNER) {
  name: String!
  description: String
  address: AddressInput!
  location: LocationInput!
  contact: EstablishmentContactInput
  openingHours: [OpeningHourInput!]!
  images: [ImageInput!]
  features: [String!]
  type: String
  priceRange: Int
}

input UpdateEstablishmentInput @join__type(graph: PARTNER) {
  name: String
  description: String
  address: AddressInput
  location: LocationInput
  contact: EstablishmentContactInput
  openingHours: [OpeningHourInput!]
  images: [ImageInput!]
  features: [String!]
  type: String
  priceRange: Int
  isActive: Boolean
}

input AddressInput @join__type(graph: PARTNER) {
  street: String!
  streetNumber: String
  complement: String
  postalCode: String!
  city: String!
  country: String!
}

input LocationInput @join__type(graph: PARTNER) @join__type(graph: DISCOVERY) {
  longitude: Float!
  latitude: Float!
}

input EstablishmentContactInput @join__type(graph: PARTNER) {
  phone: String
  email: String
  website: String
}

input OpeningHourInput @join__type(graph: PARTNER) {
  dayOfWeek: Int!
  open: String!
  close: String!
  isClosed: Boolean!
}

input ImageInput @join__type(graph: PARTNER) @join__type(graph: DISCOVERY) {
  url: String!
  alt: String
  isPrimary: Boolean
  order: Int
}

input InviteTeamMemberInput @join__type(graph: PARTNER) {
  email: String!
  firstName: String
  lastName: String
  role: TeamRole!
}

# ============================================
# INPUT TYPES - DISCOVERY
# ============================================

input CreateOfferInput @join__type(graph: DISCOVERY) {
  establishmentId: ID!
  title: String!
  description: String!
  shortDescription: String
  categoryId: ID!
  tags: [String!]
  discount: DiscountInput!
  conditions: [ConditionInput!]
  validity: ValidityInput!
  schedule: ScheduleInput
  quota: QuotaInput
  images: [ImageInput!]!
}

input UpdateOfferInput @join__type(graph: DISCOVERY) {
  title: String
  description: String
  shortDescription: String
  categoryId: ID
  tags: [String!]
  discount: DiscountInput
  conditions: [ConditionInput!]
  validity: ValidityInput
  schedule: ScheduleInput
  quota: QuotaInput
  images: [ImageInput!]
}

input DiscountInput @join__type(graph: DISCOVERY) {
  type: DiscountType!
  value: Int!
  originalPrice: Int
  formula: String
}

input ConditionInput @join__type(graph: DISCOVERY) {
  type: String!
  value: String!
  label: String!
}

input ValidityInput @join__type(graph: DISCOVERY) {
  startDate: DateTime!
  endDate: DateTime!
  timezone: String
}

input ScheduleInput @join__type(graph: DISCOVERY) {
  allDay: Boolean!
  slots: [TimeSlotInput!]
}

input TimeSlotInput @join__type(graph: DISCOVERY) {
  dayOfWeek: Int!
  startTime: String!
  endTime: String!
}

input QuotaInput @join__type(graph: DISCOVERY) {
  total: Int
  perUser: Int
  perDay: Int
}

input OffersInput @join__type(graph: DISCOVERY) {
  first: Int
  after: String
  categoryId: ID
  partnerId: ID
  establishmentId: ID
  status: OfferStatus
}

input SearchOffersInput @join__type(graph: DISCOVERY) {
  query: String!
  first: Int
  after: String
  categoryIds: [ID!]
  location: LocationInput
  maxDistance: Int
  minDiscount: Int
  sortBy: OfferSortBy
}

input NearbyOffersInput @join__type(graph: DISCOVERY) {
  location: LocationInput!
  radius: Int
  first: Int
  after: String
  categoryIds: [ID!]
}

enum OfferSortBy @join__type(graph: DISCOVERY) {
  RELEVANCE @join__enumValue(graph: DISCOVERY)
  DISTANCE @join__enumValue(graph: DISCOVERY)
  DISCOUNT @join__enumValue(graph: DISCOVERY)
  RATING @join__enumValue(graph: DISCOVERY)
  NEWEST @join__enumValue(graph: DISCOVERY)
}

# ============================================
# INPUT TYPES - BOOKING
# ============================================

input CreateOutingInput @join__type(graph: BOOKING) {
  offerId: ID!
}

input MyOutingsInput @join__type(graph: BOOKING) {
  first: Int
  after: String
  status: OutingStatus
  upcoming: Boolean
}

# ============================================
# INPUT TYPES - ENGAGEMENT
# ============================================

input CreateReviewInput @join__type(graph: ENGAGEMENT) {
  offerId: ID!
  rating: Int!
  title: String
  content: String!
  images: [String!]
}

input UpdateReviewInput @join__type(graph: ENGAGEMENT) {
  rating: Int
  title: String
  content: String
  images: [String!]
}

# ============================================
# INPUT TYPES - NOTIFICATION
# ============================================

input RegisterDeviceInput @join__type(graph: NOTIFICATION) {
  token: String!
  platform: Platform!
}

input UpdateNotificationSettingsInput @join__type(graph: NOTIFICATION) {
  push: Boolean
  email: Boolean
  sms: Boolean
  marketing: Boolean
  offerNearby: Boolean
  bookingReminder: Boolean
}
