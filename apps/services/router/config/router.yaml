# Apollo Router Configuration for Yousoon
# https://www.apollographql.com/docs/router/configuration/overview

supergraph:
  listen: 0.0.0.0:4000
  introspection: true

# Health check endpoint
health_check:
  listen: 0.0.0.0:8088
  enabled: true

# Disable homepage to enable sandbox
homepage:
  enabled: false

# CORS configuration
cors:
  origins:
    - https://yousoon.com
    - https://www.yousoon.com
    - https://business.yousoon.com
    - https://admin.yousoon.com
    - http://localhost:3000
    - http://localhost:3001
    - http://localhost:3002
    - http://localhost:3003
    - http://localhost:5173
  allow_credentials: true
  methods:
    - GET
    - POST
    - OPTIONS
  allow_headers:
    - Content-Type
    - Authorization
    - X-Apollo-Operation-Name
    - Apollo-Require-Preflight

# Telemetry
telemetry:
  exporters:
    metrics:
      prometheus:
        enabled: true
        listen: 0.0.0.0:9090
        path: /metrics

# Traffic shaping
traffic_shaping:
  all:
    timeout: 30s

# APQ (Automatic Persisted Queries)
apq:
  enabled: true
  router:
    cache:
      in_memory:
        limit: 1000

# Headers propagation
headers:
  all:
    request:
      - propagate:
          named: Authorization
      - propagate:
          named: X-Request-ID
      - propagate:
          named: Accept-Language

# Include subgraph errors
include_subgraph_errors:
  all: true

# Sandbox (development only)
sandbox:
  enabled: true
